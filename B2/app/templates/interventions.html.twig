{% extends "base_auth.html.twig" %}

{% block stylesheets %}
    <link rel="stylesheet" href="css/interventions.css">
{% endblock %}

{% block body %}
    {% if role == 'Admin' or role == 'Standardiste' %}
        <p>Nombre total d'interventions en cours : {{ count_all_interventions_en_cours }}</p>
    {% elseif role == 'Intervenant' %}
        <p>Nombre d'interventions vous étant attribuées : {{ count_interventions_en_cours }}</p>
    {% else %}
        <p>Vos demandes d'intervention :</p>
    {% endif %}
    <section>
        <form action="" method="get">
            <label for="filter_intervenant">Filtrer par intervenant :</label>
            <select name="filter_intervenant" id="filter_intervenant">
                <option value="">Tous les intervenants</option>
                {% for intervenant in intervenants %}
                    {% if intervenant['id'] == filter_intervenant %}
                        <option value="{{ intervenant['id'] }}" selected>{{ intervenant['prenom'] }} {{ intervenant['nom'] }}</option>
                    {% else %}
                        <option value="{{ intervenant['id'] }}">{{ intervenant['prenom'] }} {{ intervenant['nom'] }}</option>
                    {% endif %}
                {% endfor %}
            </select>
            <button type="submit">Filtrer</button>
        </form>

        {% if interventions %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Statut</th>
                        <th>Urgence</th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Intervenant</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for intervention in interventions %}
                        {% if intervention.Statut != 'Résolu' %}
                            <tr>
                                <td>{{ intervention.ID }}</td>
                                <td>{{ intervention.Statut }}</td>
                                <td>{{ intervention.Urgence }}</td>
                                <td>{{ intervention.Date|date("d/m/Y") }}</td>
                                <td>{{ intervention.Type }}</td>
                                <td>
                                    {% for intervenant in intervenants %}
                                    {% if intervenant.id == intervention.ID_Intervenant %}
                                     <p>{{ intervenant.nom }} {{ intervenant.prenom }}</p>
                                    {% endif %}
                                    {% endfor %}
                                </td>
                                <td>
                                    <a href="gererintervention.php?id={{ intervention.ID }}">Gérer</a>
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Aucune intervention en cours.</p>
        {% endif %}
    </section>

    <h1>Interventions résolues</h1>

    {% if interventions %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Statut</th>
                        <th>Urgence</th>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Intervenant</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for intervention in interventions %}
                        {% if intervention.Statut == 'Résolu' %}
                            <tr>
                                <td>{{ intervention.ID }}</td>
                                <td>{{ intervention.Statut }}</td>
                                <td>{{ intervention.Urgence }}</td>
                                <td>{{ intervention.Date|date("d/m/Y") }}</td>
                                <td>{{ intervention.Type }}</td>
                                <td>
                                    {% for intervenant in intervenants %}
                                    {% if intervenant.id == intervention.ID_Intervenant %}
                                     <p>{{ intervenant.nom }} {{ intervenant.prenom }}</p>
                                    {% endif %}
                                    {% endfor %}
                                </td>
                                <td>
                                    <a href="gererintervention.php?id={{ intervention.ID }}">Gérer</a>
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Aucune intervention en cours.</p>
        {% endif %}
{% endblock %}


